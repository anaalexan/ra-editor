CXXFLAGS = -Wall -pedantic -std=c++17

HEADERS = $(wildcard src/*.h)
SOURCES = $(wildcard src/*.cpp)
OBJECTS = $(SOURCES:src/%.cpp=build/%.o)

.PHONY: all
all: compile doc

.PHONY: run
run: compile
	./aleksana

.PHONY: compile
compile: aleksana

aleksana: build/main
	cp $< $@

build/main: $(OBJECTS)
	mkdir -p $(@D)
	g++ $^ -o $@

build/%.o: src/%.cpp
	mkdir -p $(@D)
	g++ $(CXXFLAGS) $< -c -o $@

debug/%.test: tests/%.test.cpp $(filter-out build/main.o,$(OBJECTS))
	mkdir -p $(@D)
	g++ $(CXXFLAGS) $< $(filter-out build/main.o,$(OBJECTS)) -I src/ -o $@

doc: Doxyfile $(HEADERS)
	doxygen Doxyfile

.PHONY: clean
clean:
	rm -rf username build/ debug/ doc/ 2>/dev/null


# Dependencies
# Generated by "g++ -MM src/*.cpp | sed -r 's|^(.*\.o)|build/\1|'"
build/Application.o: src/Application.cpp src/Application.h src/MainMenu.h \
 src/MenuBase.h src/Keywords.h src/MenuRAeditor.h src/Variable.h \
 src/FileService.h src/Relation.h src/Row.h src/MenuRAtoSQL.h \
 src/MenuKeywords.h
build/CompareOperator.o: src/CompareOperator.cpp src/CompareOperator.h \
 src/ConditionParser.h src/StringConvert.h
build/ConditionParser.o: src/ConditionParser.cpp src/ConditionParser.h
build/CrossJoin.o: src/CrossJoin.cpp src/CrossJoin.h src/Operator.h \
 src/Relation.h src/Row.h src/FileService.h
build/Difference.o: src/Difference.cpp src/Difference.h src/Operator.h \
 src/Relation.h src/Row.h src/FileService.h src/UnionCompatible.h
build/Expression.o: src/Expression.cpp src/Expression.h src/Token.h \
 src/Relation.h src/Row.h src/Operator.h src/FileService.h src/KeyRA.h \
 src/Variable.h src/CrossJoin.h src/Difference.h src/UnionCompatible.h \
 src/Intersection.h src/NaturalJoin.h src/Projection.h src/Rename.h \
 src/Selection.h src/ConditionParser.h src/CompareOperator.h \
 src/StringConvert.h src/ThetaJoin.h src/Union.h
build/FileService.o: src/FileService.cpp src/FileService.h src/Relation.h \
 src/Row.h
build/Intersection.o: src/Intersection.cpp src/Intersection.h src/Operator.h \
 src/Relation.h src/Row.h src/FileService.h src/UnionCompatible.h
build/main.o: src/main.cpp src/Application.h src/MainMenu.h src/MenuBase.h \
 src/Keywords.h src/MenuRAeditor.h src/Variable.h src/FileService.h \
 src/Relation.h src/Row.h src/MenuRAtoSQL.h src/MenuKeywords.h
build/MainMenu.o: src/MainMenu.cpp src/MainMenu.h src/MenuBase.h src/Keywords.h \
 src/MenuRAeditor.h src/Variable.h src/FileService.h src/Relation.h \
 src/Row.h src/MenuRAtoSQL.h src/MenuKeywords.h
build/MenuKeywords.o: src/MenuKeywords.cpp src/MenuKeywords.h src/MenuBase.h \
 src/Keywords.h src/MainMenu.h src/MenuRAeditor.h src/Variable.h \
 src/FileService.h src/Relation.h src/Row.h src/MenuRAtoSQL.h
build/MenuRAeditor.o: src/MenuRAeditor.cpp src/MenuRAeditor.h src/MenuBase.h \
 src/Keywords.h src/MainMenu.h src/MenuRAtoSQL.h src/Variable.h \
 src/MenuKeywords.h src/FileService.h src/Relation.h src/Row.h \
 src/Expression.h src/Token.h src/Operator.h src/KeyRA.h
build/MenuRAtoSQL.o: src/MenuRAtoSQL.cpp src/MenuRAtoSQL.h src/MenuBase.h \
 src/Keywords.h src/MainMenu.h src/MenuRAeditor.h src/Variable.h \
 src/FileService.h src/Relation.h src/Row.h src/MenuKeywords.h \
 src/Expression.h src/Token.h src/Operator.h src/KeyRA.h
build/NaturalJoin.o: src/NaturalJoin.cpp src/NaturalJoin.h src/Operator.h \
 src/Relation.h src/Row.h src/FileService.h
build/Operator.o: src/Operator.cpp src/Operator.h src/Relation.h src/Row.h \
 src/FileService.h
build/Projection.o: src/Projection.cpp src/Projection.h src/Operator.h \
 src/Relation.h src/Row.h src/FileService.h
build/Rename.o: src/Rename.cpp src/Rename.h src/Operator.h src/Relation.h \
 src/Row.h src/FileService.h
build/Selection.o: src/Selection.cpp src/Selection.h src/Operator.h \
 src/Relation.h src/Row.h src/FileService.h src/ConditionParser.h \
 src/CompareOperator.h src/StringConvert.h
build/StringConvert.o: src/StringConvert.cpp src/StringConvert.h
build/ThetaJoin.o: src/ThetaJoin.cpp src/ThetaJoin.h src/Operator.h \
 src/Relation.h src/Row.h src/FileService.h src/ConditionParser.h \
 src/CompareOperator.h src/StringConvert.h
build/UnionCompatible.o: src/UnionCompatible.cpp src/UnionCompatible.h \
 src/Relation.h src/Row.h
build/Union.o: src/Union.cpp src/Union.h src/Operator.h src/Relation.h \
 src/Row.h src/FileService.h src/UnionCompatible.h